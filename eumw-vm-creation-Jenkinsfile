pipeline {

    agent { label 'packer' }

    parameters {
        string(name: 'VERSION', defaultValue: '', description: 'Use SNAPSHOT for latest snapshot or e.g. 1.0.0 for specific release')
    }

    stages {
        stage('Checkout') {
            steps {
                deleteDir()
                sh 'hg clone http://mercurial.boskg.local/Autent/eumw'
            }
        }

        stage('Build') {
            steps {
                echo "Using version ${params.VERSION}"
                dir ('eumw/packer') {
                    sh "./create_vm.sh ${params.VERSION}"
                    archiveArtifacts artifacts: 'output-virtualbox-ovf/*.ova', caseSensitive: false, onlyIfSuccessful: true
                }
            }
        }
    }
}